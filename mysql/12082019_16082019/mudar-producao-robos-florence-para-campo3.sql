UPDATE commands 
   SET query='\nselect b.tipo\n     , b.hora\n     , replace(b.hora,\':00\',\'\') as hora_short\n	 , greatest(round(if(@ordem > 0, b.MAQ_RB1 - @MAQ_RB1, b.MAQ_RB1),2),0) as `COL_RBP 03`\n     , greatest(round(if(@ordem > 0, b.MAQ_RB2 - @MAQ_RB2, b.MAQ_RB2),2),0) as `COL_RBP 04`\n	 , greatest(round(if(@ordem > 0, b.total - @total, b.total),2),0) as total\n     , greatest(round(if(@ordem > 0, b.taxa - @taxa, b.taxa),2),0) as taxa\n     , @ordem := b.ordem as ordem\n	 , @MAQ_RB1 := b.MAQ_RB1 as v_MAQ_RB1\n     , @MAQ_RB2 := b.MAQ_RB2 as v_MAQ_RB2\n     , @total := b.total as v_total\n     , @taxa := b.taxa as v_taxa_ref\n  from (\n	select a.tipo\n		 , a.hora\n		 , sum(a.RB1) as MAQ_RB1\n		 , sum(a.RB2) as MAQ_RB2\n		 , (sum(a.RB1) + sum(a.RB2)) as total\n		 , ((((sum(a.RB1) + sum(a.RB2)) / 60) * 100) / 100) as taxa\n		 , a.ordem\n	  from (\n		select max(id) as id\n			 , mc_cd\n			 , concat(hour(inserted_at), \':00 - \', case hour(inserted_at) when 23 then \'00\' else hour(inserted_at)+1 end, \':00\') as hora\n			 , (case mc_cd when \'RB1\' then ifnull(round(max(field3),2),0)  else 0 end) as RB1\n             , (case mc_cd when \'RB2\' then ifnull(round(max(field3),2),0)  else 0 end) as RB2\n			 , \'MÂ²/Hora\' as tipo\n			 , hour(inserted_at) ordem\n			from feed\n			where ch_id = __ch_id\n			and mc_cd in(\'RB1\', \'RB2\')\n			and inserted_at between \n			   (STR_TO_DATE(\'__date_ini\', \'%Y-%m-%d %H:%i:%s\')) \n			and (STR_TO_DATE(\'__date_fin\', \'%Y-%m-%d %H:%i:%s\'))\n          group by mc_cd, day(inserted_at), hour(inserted_at)\n		  order by hour(inserted_at), mc_cd\n	) a\n	group by a.hora, a.ordem, a.tipo\n	order by a.tipo, a.ordem\n) b,\n(select @ordem := 0, @MAQ_RB1 := 0, @MAQ_RB2 := 0, @total := 0, @taxa := 0) SQLVars;\n' 
 WHERE id='3';
